<!DOCTYPE html>
<html lang="en">
<head>
        <title>Apply Debian patches step-by-step - Mathieu Leplatre</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://blog.mathieu-leplatre.info/theme/css/main.css" type="text/css" />
        <link href="https://blog.mathieu-leplatre.info/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Mathieu Leplatre ATOM Feed" />
</head>
<body>
        <section id="links">
            <li>
                <a class="" href="https://blog.mathieu-leplatre.info/" id="site-title">Blog</a>
            </li>
                <li><a class="" href="https://blog.mathieu-leplatre.info/pages/about.html">About</a></li>
        </section>
<header>
    <h1>Apply Debian patches step-by-step</h1>
<time datetime="2008-08-01T09:12:00+02:00">Fri 01 August 2008</time></header>
<article>
    <p>I thought it may be relevant to share the history of commands I used to apply a patch and submit it to <a class="reference external" href="http://launchpad.net">launchpad</a>.</p>
<div class="section" id="get-the-tools">
<h2>0) Get the tools</h2>
<ul>
<li><p class="first">You'll need a working PGP key</p>
</li>
<li><p class="first">Install the necessary tools</p>
<pre class="literal-block">
sudo apt-get install devscripts dpatch fakeroot dh-make
</pre>
</li>
</ul>
<p><em>(I might have forgotten some...)</em> :)</p>
</div>
<div class="section" id="get-the-files">
<h2>1) Get the files</h2>
<ul>
<li><p class="first">Get the last package source, from the package page : <a class="reference external" href="http://packages.ubuntu.com/hardy/exaile">http://packages.ubuntu.com/hardy/exaile</a></p>
<pre class="literal-block">
dget -x http://archive.ubuntu.com/ubuntu/pool/universe/e/exaile/exaile_0.2.11.1-0ubuntu3.dsc
</pre>
</li>
<li><p class="first">Get the patch file</p>
<pre class="literal-block">
wget http://launchpadlibrarian.net/9466876/gui_track_filter.patch
</pre>
</li>
<li><p class="first">Step in the package code</p>
<pre class="literal-block">
cd exaile-0.2.11.1/
</pre>
</li>
</ul>
</div>
<div class="section" id="apply-the-patch">
<h2>2) Apply the patch</h2>
<ul>
<li><p class="first">Have a look at the list of patches in the <cite>debian/patches</cite> folder</p>
<pre class="literal-block">
ls debian/patches/

00list
01_fix_makefile_for_pysupport.dpatch
02_files-on-share-dir.dpatch
03_fix_mmkeys.dpatch
</pre>
</li>
<li><p class="first">Create yours respecting dpatch filenames pattern (without extension)</p>
<pre class="literal-block">
dpatch-edit-patch 04_fix_search_exit
</pre>
</li>
<li><p class="first">You now have a shell in the <cite>/tmp</cite> folder.</p>
</li>
<li><p class="first">Apply the patch file</p>
<pre class="literal-block">
patch -p0 &lt; $HOME/Desktop/gui_track_filter.patch
</pre>
</li>
<li><p class="first">Exit the shell</p>
</li>
</ul>
</div>
<div class="section" id="describe-your-changes">
<h2>3) Describe your changes</h2>
<ul>
<li><p class="first">Add your dpatch name in the <cite>00list</cite> file</p>
<pre class="literal-block">
nano debian/patches/00list
</pre>
</li>
<li><p class="first">Modify Debian changelog using</p>
<pre class="literal-block">
dch -i
</pre>
</li>
<li><p class="first">Your name and signing information will be automatically added.</p>
</li>
<li><p class="first">Look at previous descriptions and respect their structure.</p>
</li>
<li><p class="first">Include launchpad bug number with <cite>(LP: #number)</cite> string</p>
<pre class="literal-block">
exaile (0.2.11.1-0ubuntu4) hardy; urgency=low
</pre>
</li>
<li><p class="first"><cite>debian/patches/04_fix_search_exit.dpatch</cite></p>
<pre class="literal-block">
debian/patches/00list:
- Fix clean search terms on exit (LP: #95860)

-- Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;  Tue, 27 May 2008 10:45:42 -0300
</pre>
</li>
</ul>
</div>
<div class="section" id="create-debdiff">
<h2>4) Create debdiff</h2>
<ul>
<li><p class="first">Create the dsc and diff files using</p>
<pre class="literal-block">
debuild -S
cd ..
</pre>
</li>
<li><p class="first">Step in the package code</p>
</li>
<li><p class="first">Create the debdiff file using</p>
<pre class="literal-block">
debdiff exaile_0.2.11.1-0ubuntu3.dsc exaile_0.2.11.1-0ubuntu4.dsc &gt; exaile_0.2.11.1-0ubuntu4.debdiff
</pre>
</li>
<li><p class="first">Have a look at it, it should include all modifications of previous steps</p>
<pre class="literal-block">
diff -Nru exaile-0.2.11.1/debian/changelog exaile-0.2.11.1/debian/changelog
--- exaile-0.2.11.1/debian/changelog        2008-05-27 10:54:56.000000000 -0300
+++ exaile-0.2.11.1/debian/changelog        2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -1,3 +1,11 &#64;&#64;
+exaile (0.2.11.1-0ubuntu4) hardy; urgency=low
+
+  * debian/patches/04_fix_search_exit.dpatch,
+    debian/patches/00list:
+    - Fix clean search terms on exit (LP: #95860)
+
+ -- Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;  Tue, 27 May 2008 10:45:42 -0300
+
 exaile (0.2.11.1-0ubuntu3) hardy; urgency=low

   * debian/patches/03_fix_mmkeys.dpatch,
diff -Nru /tmp/RIBRnUlXkn/exaile-0.2.11.1/debian/patches/00list /tmp/XQpuhOBOst/exaile-0.2.11.1/debian/patches/00l
ist
--- exaile-0.2.11.1/debian/patches/00list   2008-05-27 10:54:56.000000000 -0300
+++ exaile-0.2.11.1/debian/patches/00list   2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -1,3 +1,5 &#64;&#64;
 01_fix_makefile_for_pysupport
 02_files-on-share-dir
 03_fix_mmkeys
+04_fix_search_exit
+
diff -Nru /tmp/RIBRnUlXkn/exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch /tmp/XQpuhOBOst/exaile-0.2.11.1
/debian/patches/04_fix_search_exit.dpatch
--- exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch        1969-12-31 21:00:00.000000000 -0300
+++ exaile-0.2.11.1/debian/patches/04_fix_search_exit.dpatch        2008-05-27 10:54:56.000000000 -0300
&#64;&#64; -0,0 +1,27 &#64;&#64;
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 04_fix_search_exit.dpatch by Mathieu Leplatre &lt;xxxx&#64;gmail.com&gt;
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: Patch to clean search terms on exit
+
+&#64;DPATCH&#64;
+diff -urNad exaile-0.2.11.1~/xl/gui/main.py exaile-0.2.11.1/xl/gui/main.py
+--- exaile-0.2.11.1~/xl/gui/main.py        2007-11-07 13:12:52.000000000 -0300
++++ exaile-0.2.11.1/xl/gui/main.py 2008-05-27 10:37:36.000000000 -0300
+&#64;&#64; -1659,8 +1659,16 &#64;&#64;
+         queuefile = xl.path.get_config('queued.save')
+         if os.path.isfile(queuefile):
+             os.unlink(queuefile)
++
+
+         if self.player.current: self.player.current.stop()
++
++        # Clear the search filter so that the entire playlist is saved
++        self.tracks_filter.set_text('')
++        try:
++            self.on_search()
++        except:  # In case we're quitting before the playlist loaded
++            pass
+
+         for i in range(self.playlists_nb.get_n_pages()):
+             page = self.playlists_nb.get_nth_page(i)
</pre>
</li>
</ul>
</div>

	<p>
        <a href="https://blog.mathieu-leplatre.info/tag/debian.html">#debian</a>,         <a href="https://blog.mathieu-leplatre.info/tag/howto.html">#howto</a>	  - Posted in the <a href="https://blog.mathieu-leplatre.info/category/sys.html">Sys</a> category
	</p>
  <hr>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'https://blog.mathieu-leplatre.info/apply-debian-patches-step-by-step.html';
      this.page.identifier = 'apply-debian-patches-step-by-step';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//mathieuleplatre.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
</article>

        <footer>
            <p>
                Â© Copyright 2020 by Mathieu Leplatre. <a href="http://mathieu.agopian.info/mnmlist/theme.html">mnmlist Theme</a>
            </p>
            <p>Content licensed under the Creative Commons attribution-noncommercial-sharealike License. </p>
        </footer>
</body>
</html>